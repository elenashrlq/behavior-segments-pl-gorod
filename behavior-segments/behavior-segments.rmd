---
title: "Сегменты пользователей по посещаемости"
date: '*Период: 4авг. –  3сен.*.'
output: 
  word_document:
  fig_width: 6
  fig_height: 4
reference_docx: my-styles.docx
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width=8, fig.height=4)
```

*Исключены пользователи, замеченные во фроде и посещения с IP адресов офиса. Транзакции учитываются только по партнерам*

## Описание сегментов
В зависимости посещаемости сайтов и приложений можно выделить 7 сегментов зарегистрированных пользователей:

+ **0 visits** – не было посещений;
+ **Some visits** – у пользователя незначительно кол-во посещений (в среднем 6 визитов на сайте и 9 визитов в МП);
+ **App+** – пользователь посещал преимущественно приложения (в среднем – 33 визита в МП);
+ **App++** – пользователь посещал преимущественно приложения (в среднем – 66 визитов МП);
+ **Web+** – в посещениях пользователя много визитов на сайт (в среднем – 32 визита на сайте);
+ **Web++** – в посещениях пользователя еще больше визитов на сайт (в среднем – 71 визит на сайте);
+ **Web++** – два пользователя с рекордными суммарными посещениями сайта и приложения (в среднем 128 визита на сайте и 132 – в МП).

###Резюме
Чем больше пользователь посещает ресурсы ПЛ «Город» в интернете, тем больше вероятность совершения транзакции (и наоборот).

```{r code, warning=FALSE, message=FALSE, results='hide'}
rm(list=lsf.str())

setwd("C:\\Users\\NK-1\\Documents\\GitHub\\loyalty_program_Gorod\\behavior-segments")

# open files, format, rename and filter
library(rio)
convert("transactions-data.xlsx", "transactions-data.csv")
convert("fraud-data.xlsx", "fraud-data.csv")

client_list <- read.csv("client-data.csv", encoding = "UTF-8", stringsAsFactors = FALSE, sep = ';')
master_list1 <- read.csv("transactions-data.csv", stringsAsFactors = FALSE,  encoding = "UTF-8")
fraud <- read.csv("fraud-data.csv", encoding = "UTF-8", stringsAsFactors = FALSE)
bq_list <- read.csv("web-site-and-app-data.csv", encoding = "UTF-8", stringsAsFactors = FALSE)
partner_cat1 <- read.csv("partners_directory.csv", encoding = "UTF-8", stringsAsFactors = T, sep = ',',
                        colClasses = rep('character'))

library(dplyr)
client_list <- client_list %>%
  rename(userid='X.U.FEFF.User.ID',
         client_type='Тип.клиентского.приложения',
         level='Уровень',
         reg_date='Дата.регистрации') %>%
  mutate(userid=as.character(userid),
         client_type=as.character(client_type),
         level=as.integer(level))

fraud <- fraud %>%
  rename(userid='User.ID')

master_list <- master_list1 %>%
  rename(userid='User.ID',
         date_cassa='Дата.Касса.',
         date_procesing='Дата',
         type_partn='Тип.партнера',
         partner='Партнер.Группа.',
         regs_in_per='Кол.во.регистраций.за.период...чел.',
         qt_trans='Кол.вo.транзакций..ед.',
         sum_trans='Сумма.покупок.деньги.бонусы...руб.',
         sum_trans_money='Сумма.покупок.деньги...руб.',
         rate_inc_bon='Средний.процент.начисления',
         share_dec_bon='Средний.процент.списания',
         sum_inc_bon='Сумма.начисленных.бонусов..руб.',
         sum_inc_bon_cor='Сумма.начислений..с.корректировками.',
         sum_dec_bon='Сумма.списанных.бонусoв..руб.',
         sum_inc_bon_par='Суммa.начисленная.партнером..руб.',
         rate_inc_bon_par='Начислено.партнером...')  %>%
  filter(type_partn!='Метро') %>%
  filter(userid!='-') %>%
  filter(!(userid %in% fraud$userid)) %>%
  mutate(userid=as.character(userid),
         rate_inc_bon=as.numeric(rate_inc_bon),
         share_dec_bon=as.numeric(share_dec_bon),
         rate_inc_bon_par=as.numeric(rate_inc_bon_par),
         users_with_trans=ifelse(qt_trans>0,1,0)) %>%
  mutate(date_cassa=gsub('T', ' ', date_cassa),
         date_cassa=gsub('Z', '', date_cassa),
         date_cassa=as.Date(date_cassa, format='%Y-%m-%d %H:%M:%S'),
         date_procesing=gsub('T', ' ', date_procesing),
         date_procesing=gsub('Z', '', date_procesing),
         date_procesing=as.Date(date_procesing, format='%Y-%m-%d %H:%M:%S')) %>%
  filter(date_cassa > '2018-08-03' & date_cassa < '2018-09-04') %>%
  filter(sum_trans>-0.99) ## почему в исходнике отрицательная сумма транзакции?
         

# merge trandactions data with clients- and web-and-app data
all_qlick_tab <- merge(master_list, client_list, all.x = T, all.y = T, by = c('userid'))
all_tab <- merge(all_qlick_tab, bq_list, all.x = T, all.y= T, by.x = 1, by.y = 1)

# check number of rows
dim(client_list)
dim(master_list)
dim(all_qlick_tab)
dim(all_tab)

## remove na
all_tab_withoutna <- all_tab[,-c(2,3)] ##exclude columns with dates
all_tab_withoutna[is.na(all_tab_withoutna)] <- 0

# create segments
visits_group <- all_tab_withoutna  %>%
  group_by(sessions_in_web, sessions_in_app) %>%
  summarise(users=length(unique(userid)),
            users_with_trans=sum(users_with_trans),
            avg_sessions_total=sum(sessions_in_web+sessions_in_app)/sum(users),
            avg_bill=sum(sum_trans)/sum(qt_trans),
            avg_trans_per_user=sum(qt_trans)/sum(users_with_trans),
            share_dec_bon=mean(share_dec_bon),
            rate_inc_bon_par=mean(rate_inc_bon_par),
            rate_inc_bon=mean(rate_inc_bon),
            delta_rates=rate_inc_bon_par-rate_inc_bon,
            level=mean(level))

set.seed(123)
visits_group$segments <- kmeans(visits_group[,c('sessions_in_web', 'sessions_in_app')], 7, nstart = 30)$cluster

visits_group$segments[visits_group$sessions_in_web==0 & visits_group$sessions_in_app==0] <- '0 visits'
visits_group$segments[visits_group$sessions_in_web==0 & visits_group$sessions_in_app==1] <- '1 visit'
visits_group$segments[visits_group$sessions_in_web==1 & visits_group$sessions_in_app==0] <- '1 visit'
visits_group$segments[visits_group$segments==4 | visits_group$segments==1] <- 'App++'
visits_group$segments[visits_group$segments==2] <- 'Web++'
visits_group$segments[visits_group$segments==7 ] <- 'App+'
visits_group$segments[visits_group$segments==3 ] <- 'Web+'
visits_group$segments[visits_group$segments==6 ] <- 'Web++ App ++'
visits_group$segments[visits_group$segments==5 ] <- 'Some visits'

sapply(split(visits_group[,c(1,2)], visits_group$segments), colMeans) ## среднее значение по сегментам

## see users on plot by segments
library(ggplot2)
visits_group_p <- ggplot(visits_group, 
                         aes(sessions_in_web, sessions_in_app, 
                             color = as.factor(segments), 
                             size=avg_sessions_total)) + 
  geom_point() + theme_classic() +
  labs(title = "Сегменты по посещаемости сайта и приложений",
       y = "Количество посещений APP",
       x = "Количество посещений WEB",
       color='Сегменты',
       size='Количество посещений. всего')
  
# merge all data with segment group all data by segments for plots
calc_data <- merge(all_tab_withoutna, 
                   visits_group[,c('sessions_in_web', 'sessions_in_app','avg_sessions_total', 'segments')],
                   by.x = c('sessions_in_web', 'sessions_in_app'),
                   by.y = c('sessions_in_web', 'sessions_in_app'))

segment_tab <- calc_data %>%
  group_by(segments) %>%
  summarise(users=length(unique(userid)),
            users_with_trans=length(unique(userid[qt_trans>0])),
            avg_sessions_total=sum(sessions_in_web+sessions_in_app)/sum(users),
            avg_sessions_in_web=sum(sessions_in_web)/sum(users),
            avg_sessions_in_app=sum(sessions_in_app)/sum(users),
            avg_bill=sum(sum_trans)/sum(qt_trans),
            avg_trans_per_user=sum(qt_trans)/sum(users_with_trans),
            share_dec_bon=mean(share_dec_bon),
            rate_inc_bon_par=mean(rate_inc_bon_par),
            rate_inc_bon=mean(rate_inc_bon),
            delta_rates=rate_inc_bon_par-rate_inc_bon,
            level=mean(level),
            sum_trans=sum(sum_trans),
            qt_trans=sum(qt_trans))

segment_tab$segments <- as.factor(segment_tab$segments)


# build plots 
## 1
g1 <- ggplot(data=segment_tab, 
                aes(x=factor(segment_tab$segments, levels(segment_tab$segments)[c(1,4,5,2,6,3,7)]), 
                    y=avg_bill, fill=segments))+
  geom_col(position = "dodge", width=.7) +
  theme_classic() +
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  labs(title = "Средний чек, руб.",
       y = NULL,
       x = "Сегменты",
       fill='Сегменты') +
  geom_text(aes(label = paste0(format(round(avg_bill/1000,digits=1),nsmall = 1),"K"),
                y= avg_bill), stat="identity", position = position_dodge(width=.7),
            vjust = -.3)


## 2
g2 <- ggplot(data=segment_tab, 
             aes(x=factor(segment_tab$segments, levels(segment_tab$segments)[c(1,4,5,2,6,3,7)]), 
                 y=avg_trans_per_user, fill=segments))+
  geom_col(position = "dodge", width=.7) +
  theme_classic() +
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  labs(title = "Ср. кол-во транзакций на пользователя",
       y = NULL,
       x = "Сегменты",
       fill='Сегменты') +
  geom_text(aes(label = round(avg_trans_per_user,digits=1),
                y= avg_trans_per_user), stat="identity", position = position_dodge(width=.7),
            vjust = -.3, size=3)

## 3
g3 <- ggplot(data=segment_tab, 
             aes(x=factor(segment_tab$segments, levels(segment_tab$segments)[c(1,4,5,2,6,3,7)]), 
                 y=share_dec_bon, fill=segments))+
  geom_col(position = "dodge", width=.7) +
  theme_classic() +
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  labs(title = "Ср. % списания пользователей от суммы покупки",
       y = NULL,
       x = "Сегменты",
       fill='Сегменты') +
  geom_text(aes(label = paste0(round(share_dec_bon*100,digits=1),"%"),
                y= share_dec_bon), stat="identity", position = position_dodge(width=.7),
            vjust = -.3)

## 4
g4 <- ggplot(data=segment_tab, 
             aes(x=factor(segment_tab$segments, levels(segment_tab$segments)[c(1,4,5,2,6,3,7)]), 
                 y=users, fill=segments))+
  geom_col(position = "dodge", width=.7) +
  theme_classic() +
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  labs(title = "Количество пользователей в сегментах",
       y = NULL,
       x = "Сегменты",
       fill='Сегменты') +
  geom_text(aes(label = users,
                y= users), stat="identity", position = position_dodge(width=.7),
            vjust = -.3)

g4_u <- ggplot(data=segment_tab, 
             aes(x=factor(segment_tab$segments, levels(segment_tab$segments)[c(1,4,5,2,6,3,7)]), 
                 y=users_with_trans/users, fill=segments))+
  geom_col(position = "dodge", width=.7) +
  theme_classic() +
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  labs(title = "Доля пользователей с транзакциями",
       subtitle="(от всех пользователей в сегменте)",
       y = NULL,
       x = "Сегменты",
       fill='Сегменты') +
  geom_text(aes(label = paste0(round(users_with_trans/users*100,1),"%"),
                y= users_with_trans/users), stat="identity", position = position_dodge(width=.7),
            vjust = -.3, size=3)

## 4_a
library(reshape2)
segment_melt <- melt(segment_tab)
serment_melt_cut <- segment_melt[segment_melt$variable %in% c('share_dec_bon', 'rate_inc_bon', 'rate_inc_bon_par', 'delta_rates'),]
levels(serment_melt_cut$variable)[c(8,9,10,11)] <- 
  c('Доля списания от суммы покупки', 'Ср. % начисления партнерами', 
    'Ср. % начисления пользователям', 'Маржа')

serment_melt_lev <- segment_melt[segment_melt$variable %in% c('level'),]
levels(serment_melt_lev$variable)[12] <- 
  c('Уровень пользователя')

normalizer <- max(serment_melt_cut$value) / max(serment_melt_lev$value)

g4_a <- ggplot(data=serment_melt_cut, 
               aes(x=factor(serment_melt_cut$segments, levels(serment_melt_cut$segments)), 
                   y=value/normalizer, fill=variable))+
  geom_col(position = "dodge", width=.7) +
  
  geom_text(aes(label = paste0(round(value*100,digits=1),"%"),
                y= value/normalizer), stat="identity", position = position_dodge(width=.7),
            vjust = -.3, size=3) + 

  geom_line(data = serment_melt_lev, 
            size=1.3,
            color='#FF6633',
            aes(x=segments, y=value, group = 1)) +
  geom_text(data = serment_melt_lev, aes(x=segments, y=value, group = 1, 
                                         label = round(value,1)), size=3.5, vjust = -.4) +
  
  
  scale_y_continuous(sec.axis = sec_axis(trans= ~.*normalizer,
                                         name = 'Уровень пользователя')) +
  theme_classic() +
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        legend.position="bottom") + 
  labs(title = "Проценты списания и начисления",
       y = "Процент,%",
       x = "Сегменты",
       fill='Показатель')

# merge all data with partners categories and build plots by partners categories
partner_cat <- partner_cat1 
calc_data_advanced <- merge(calc_data, partner_cat, all.x=T, by.x=c('ID.ТСП'), 
                            by.y = c('Partner.ID'))

calc_part_data <- calc_data_advanced %>%
  group_by(Category, segments) %>%
  summarise(users=n(),
            avg_sessions_total=sum(sessions_in_web+sessions_in_app)/sum(users),
            avg_sessions_in_web=sum(sessions_in_web)/sum(users),
            avg_sessions_in_app=sum(sessions_in_app)/sum(users),
            avg_bill=sum(sum_trans)/sum(qt_trans),
            avg_trans_per_user=sum(qt_trans)/sum(users_with_trans),
            share_dec_bon=mean(share_dec_bon),
            rate_inc_bon_par=mean(rate_inc_bon_par),
            rate_inc_bon=mean(rate_inc_bon),
            delta_rates=rate_inc_bon_par-rate_inc_bon,
            level=mean(level),
            sum_trans=sum(sum_trans),
            users_with_trans=length(unique(userid[qt_trans>0])),
            qt_trans=sum(qt_trans))


calc_part_data_full <- merge(calc_part_data, segment_tab, all.x = T, by = c('segments'))

calc_part_data_procent <- mutate(calc_part_data_full,
                                 sum_trans=sum_trans.x/sum_trans.y,
                                 users_with_trans=users_with_trans.x/users_with_trans.y,
                                 qt_trans=qt_trans.x/qt_trans.y)

## order factor levels
calc_part_data_procent$Category <- as.factor(calc_part_data_procent$Category)

calc_part_data_procent$Category <- factor(calc_part_data_procent$Category,levels(calc_part_data_procent$Category))


calc_part_data_procent <- calc_part_data_procent[complete.cases(calc_part_data_procent),]

## 
p1 <- ggplot(calc_part_data_procent, 
       aes(x = "", y=sum_trans, fill = factor(Category, levels = levels(Category)[c(6,4,5,1,3,2,7:12)]))) + 
  geom_bar(width = 1, stat = "identity") +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(), 
        plot.title = element_text(hjust=0.5)) + 
  labs(fill="Категория", 
       x=NULL, 
       y=NULL, 
       title="Общая сумма покупок") + facet_wrap(segments~.)  + coord_polar(theta = "y", start=0,
                                                                           direction = -1) + 
  geom_text(aes(label=ifelse(sum_trans>0.08,paste0(round(sum_trans*100,1),'%'),
                             ''),
                y=sum_trans),
            position = position_stack(vjust = 0.4),
            size=3.5) 
  
##
p2 <- ggplot(calc_part_data_procent, 
             aes(x = "", y=qt_trans, fill=factor(Category, levels = levels(Category)[c(6,4,5,1,3,2,7:12)])))  + 
  geom_bar(width = 1, stat = "identity") +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(), 
        plot.title = element_text(hjust=0.5)) + 
  labs(fill="Категория", 
       x=NULL, 
       y=NULL, 
       title="Количество транзакций") + facet_wrap(segments~.)  + coord_polar(theta = "y", start=0,
                                                                           direction = -1, clip='off') + 
  geom_text(aes(label=ifelse(qt_trans>0.08,paste0(round(qt_trans*100,1),'%'),
                             ''),
                y=qt_trans),
            position = position_stack(vjust = 0.5),
            size=3.5) 

# build plots
calc_data_advanced$client_type <- as.factor(calc_data_advanced$client_type)

calc_type_data <- calc_data_advanced %>%
  group_by(client_type, segments) %>%
  summarise(users=length(unique(userid)),
            avg_sessions_total=sum(sessions_in_web+sessions_in_app)/sum(users),
            avg_sessions_in_web=sum(sessions_in_web)/sum(users),
            avg_sessions_in_app=sum(sessions_in_app)/sum(users),
            avg_bill=sum(sum_trans)/sum(qt_trans),
            avg_trans_per_user=sum(qt_trans)/sum(users_with_trans),
            share_dec_bon=mean(share_dec_bon),
            rate_inc_bon_par=mean(rate_inc_bon_par),
            rate_inc_bon=mean(rate_inc_bon),
            delta_rates=rate_inc_bon_par-rate_inc_bon,
            level=mean(level),
            sum_trans=sum(sum_trans),
            users_with_trans=length(unique(userid[qt_trans>0])),
            qt_trans=sum(qt_trans))


calc_type_data_full <- merge(calc_type_data, segment_tab, all.x = T, by = c('segments'))

calc_type_procent <- mutate(calc_type_data_full,
                                 sum_trans=sum_trans.x/sum_trans.y,
                                 users_with_trans=users_with_trans.x/users_with_trans.y,
                                 users=users.x/users.y,
                                 qt_trans=qt_trans.x/qt_trans.y)

##
p3 <- ggplot(calc_type_procent, 
             aes(x = "", y=users, fill=client_type))  + 
  geom_bar(width = 1, stat = "identity") +
  theme(axis.line = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(), 
        plot.title = element_text(hjust=0.5)) + 
  labs(fill="Источник регистрации", 
       x=NULL, 
       y=NULL, 
       title="Распределение пользователей по источникам регистрации") + facet_wrap(segments~.)  + coord_polar(theta = "y", start=0,
                                                                              direction = -1, clip='off') + 
  geom_text(aes(label=ifelse(users>0.05,paste0(round(users*100,1),'%'),
                             ''),
                y=users),
            position = position_stack(vjust = 0.5),
            size=3.5) 

## see users on plot by type of registration
visits_group_c <- calc_data_advanced  %>%
  group_by(sessions_in_web, sessions_in_app, client_type, segments) %>%
  summarise(users=n(),
            users_with_trans=sum(users_with_trans),
            avg_sessions_total=sum(sessions_in_web+sessions_in_app)/sum(users),
            avg_bill=sum(sum_trans)/sum(qt_trans),
            avg_trans_per_user=sum(qt_trans)/sum(users_with_trans),
            share_dec_bon=mean(share_dec_bon),
            rate_inc_bon_par=mean(rate_inc_bon_par),
            rate_inc_bon=mean(rate_inc_bon),
            delta_rates=rate_inc_bon_par-rate_inc_bon,
            level=mean(level))

visits_group_c$client_type <- as.factor(visits_group_c$client_type)
levels(visits_group_c$client_type) <- c('App', 'App', 'Web')

visits_group_p <- ggplot(visits_group, 
                         aes(sessions_in_web, sessions_in_app, 
                             color = as.factor(segments))) + 
  geom_point(size=5) + theme_classic() +
  labs(title = "Сегменты по посещаемости сайта и приложений",
       y = "Количество посещений APP",
       x = "Количество посещений WEB",
       color='Сегменты')
```


```{r segments_plot, echo=FALSE}
visits_group_p + scale_color_brewer(palette = 'Set2', direction=1)
```

### Комментарии к диаграмме

+ Точки на диаграмме - это пользователи. 
+ Чем **правее** они расположены, тем больше посещений сайта у этих пользователей.
+ Чем **выше** они расположены, тем больше посещений приложений у этих пользователей.

##### 

##Размер сегментов особенности

### Выводы:
+ Повторных посещений веб-сайта значительно меньше, чем повторных посещений приложений (298 пользователей **App+** против 38 человек **Web+** и 110 пользователей **App++** против 12 – **Web++**).

+ Более 3,5 тыс. пользователей сегмента **Some visits** – те, у кого было мало посещений, и их сложно однозначно отнести к сегментам активных пользователей и выявить в их поведении отличия.

+ В сегмент **Web++ App++** попало только 2 пользователя, однако он выделен в отдельную группу из-за значительно отличающихся транзакционных показателей (так называемые «выбросы»).

```{r segments_size, echo=FALSE}
g4 + scale_fill_manual(values=c("#996600", "#CCCC66", "#669900", "#FFCC00", "#CC6600", 
                                "#CC9933", "#CC6600"))

```

##Распределение пользователей в сегментах по источнику регистрации
### Выводы
+ Пользователи, зарегистрировавшиеся через сайт, продолжают заходить в проект как через сайт, так и через мобильное приложение;

+ Пользователи, зарегистрировавшиеся через приложение, преимущественно продолжают использовать приложение. В целом они меньше возвращаются в онлайн:


```{r type_registration, echo=FALSE, fig.width=9, fig.height=7}
p3 + scale_fill_brewer(palette = 'Set2', direction = -1)

```

## Транзакционные показатели по сегментам пользователей
### Выводы
+ Наиболее заметна корреляция сегментов и **доли пользователей с транзакциями** (от всех пользователей в сегменте) – чем больше пользователь посещает ресурсы ПЛ «Город» в интернете, тем больше вероятность совершения транзакции (и наоборот):

```{r share_users_with_trans, echo=FALSE}
g4_u + scale_fill_manual(values=c("#996600", "#CCCC66", "#669900", "#FFCC00", "#CC6600", 
                                  "#CC9933", "#666633"))

```

+ В качестве гипотезы можно предположить наличие корреляции сегментов со **ср. кол-вом транзакций** на пользователя (есть тенденция, но не очень явная):

```{r avg_trans, echo=FALSE}
g2 + scale_fill_manual(values=c("#996600", "#CCCC66", "#669900", "#FFCC00", "#CC6600", 
                                "#CC9933", "#666633"))


```

+ Данных по среднему чеку и ср. % списания пользователей от суммы покупки пока недостаточно для выводов: 

```{r avg_bill, echo=FALSE}
g1 + scale_fill_manual(values=c("#996600", "#CCCC66", "#669900", "#FFCC00", "#CC6600", 
                                "#CC9933", "#666633"))

```

```{r procent, echo=FALSE}
g3 + scale_fill_manual(values=c("#996600", "#CCCC66", "#669900", "#FFCC00", "#CC6600", 
                                "#CC9933", "#666633"))

```

+ Более активные по посещаемости пользователи в целом имеют более высокий **уровень в программе**: 

```{r levels, echo=FALSE, fig.width=11, fig.height=6}
g4_a + scale_fill_manual(values=c("#996600", "#CCCC66", "#669900", "#FFCC00", "#FF6633", 
                                  "#CC9933", "#666633"))

```

## Покупки пользователей в зависимости от категории партнера

+ По количеству транзакций и сумме покупок в ТОП-3 всех сегментов входит категория **«Красота и здоровье»**. Однако у пользователей мобильных приложений такая доля выше, чем у посетителей сайта.

+ **Admitad** также входит в ТОП-3, но только у тех пользователей, кто посещает онлайн-ресурсы ПЛ «Город».

+ Категория **«Продукты»** привлекает наоборот пользователей, которые чаще используют сайт.

+ Общая сумма покупок в **Admitad** также выше также у посетителей сайта.

+ В **кафе и рестораны** ходят чаще оффлайн-пользователи, а покупки в категории **«Дом, дача и ремонт»** более актуальны для пользователей моб. приложений.


```{r sum_trans, echo=FALSE, warning=F, fig.width=9, fig.height=7}
p1 + scale_fill_brewer(palette = 'Spectral') ##RdYlGn

```

```{r qt_trans, echo=FALSE, warning=F, fig.width=9, fig.height=7}
p2 + scale_fill_brewer(palette = 'Spectral') ##RdYlGn

```


### Спасибо!











